<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
		<style>
			html, body {
				height: 100%;
				margin: 0;
				font-family: ui-sans-serif, system-ui, sans-serif;
			}

			main {
				height: 100%;
				display: flex;
				flex-wrap: wrap;
				justify-content: center;
				align-items: center;
			}

			form {
				display: flex;
				flex-direction: column;
				gap: 10px;
			}
		</style>
	</head>
	<body>
		<main>
			<form action="./download">
				<label for="platform">Platform
					<select id="platformSelect" name="platform">
						<option disabled selected value="">-- pick one --</option>
					</select>
				</label>
				<label for="version">Milestone or exact version
					<input name="version" placeholder="M134" required>
				</label>
				<button>Download</button>
			</form>
		</main>
		<script type="module">
			const platformsResponse = await fetch("./platforms");
			const platforms = await platformsResponse.json();
			for (const [platform, platformConfig] of Object.entries(platforms)) {
				const el = document.createElement("option");
				el.value = platform;
				el.textContent = platformConfig.displayName;
				platformSelect.append(el);
			}

			try {
				const userAgentData = await navigator.userAgentData.getHighEntropyValues(["architecture", "platform"]);
				if (userAgentData.platform == "macOS") {
					if (userAgentData.architecture == "x86") {
						platformSelect.value = "macIntel";
					} else {
						platformSelect.value = "macArm";
					}
				} else if (userAgentData.platform == "Windows") {
					platformSelect.value = "windows";
				}
			} catch {
				// Probably an unsupported browser
			}
		</script>
	</body>
</html>
